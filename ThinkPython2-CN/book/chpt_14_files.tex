

%ğŸ% \chapter{Files  |  æ–‡ä»¶}
\chapter{æ–‡ä»¶}

%ğŸ% This chapter introduces the idea of ``persistent'' programs that
%ğŸ% keep data in permanent storage, and shows how to use different
%ğŸ% kinds of permanent storage, like files and databases.

æœ¬ç« å°†ä»‹ç» ``æŒä¹…\footnote{persistent}'' ç¨‹åºçš„æ¦‚å¿µï¼Œå³æ°¸ä¹…å‚¨å­˜æ•°æ®çš„ç¨‹åºï¼Œå¹¶è¯´æ˜å¦‚ä½•ä½¿ç”¨ä¸åŒç§ç±»çš„æ°¸ä¹…å­˜å‚¨å½¢å¼ï¼Œä¾‹å¦‚æ–‡ä»¶å’Œæ•°æ®åº“ã€‚

%ğŸ% \section{Persistence  |  æŒä¹…åŒ–}
\section{æŒä¹…åŒ–}

\index{file}  \index{type!file}  \index{persistence}

%ğŸ% Most of the programs we have seen so far are transient in the
%ğŸ% sense that they run for a short time and produce some output,
%ğŸ% but when they end, their data disappears.  If you run the program
%ğŸ% again, it starts with a clean slate.

ç›®å‰æˆ‘ä»¬æ‰€è§åˆ°çš„å¤§å¤šæ•°ç¨‹åºéƒ½æ˜¯ä¸´æ—¶çš„\footnote{transient}ï¼Œ
å› ä¸ºå®ƒä»¬åªè¿è¡Œä¸€æ®µæ—¶é—´å¹¶è¾“å‡ºä¸€äº›ç»“æœï¼Œä½†å½“å®ƒä»¬ç»“æŸæ—¶ï¼Œæ•°æ®ä¹Ÿå°±æ¶ˆå¤±äº†ã€‚
å¦‚æœä½ å†æ¬¡è¿è¡Œç¨‹åºï¼Œå®ƒå°†ä»¥å…¨æ–°çš„çŠ¶æ€å¼€å§‹ã€‚

%ğŸ% Other programs are {\bf persistent}: they run for a long time
%ğŸ% (or all the time); they keep at least some of their data
%ğŸ% in permanent storage (a hard drive, for example); and
%ğŸ% if they shut down and restart, they pick up where they left off.

å¦ä¸€ç±»ç¨‹åºæ˜¯ {\bf æŒä¹…çš„} ï¼šå®ƒä»¬é•¿æ—¶é—´è¿è¡Œ(æˆ–è€…ä¸€ç›´åœ¨è¿è¡Œ)ï¼›
å®ƒä»¬è‡³å°‘å°†ä¸€éƒ¨åˆ†æ•°æ®è®°å½•åœ¨æ°¸ä¹…å­˜å‚¨(å¦‚ä¸€ä¸ªç¡¬ç›˜ä¸­)ï¼›
å¦‚æœä½ å…³é—­ç¨‹åºç„¶åé‡æ–°å¯åŠ¨æ—¶ï¼Œå®ƒä»¬å°†ä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹å¼€å§‹ç»§ç»­ã€‚

%ğŸ% Examples of persistent programs are operating systems, which
%ğŸ% run pretty much whenever a computer is on, and web servers,
%ğŸ% which run all the time, waiting for requests to come in on
%ğŸ% the network.

æŒä¹…ç¨‹åºçš„ä¸€ä¸ªä¾‹å­æ˜¯æ“ä½œç³»ç»Ÿï¼Œåœ¨ä¸€å°ç”µè„‘å¼€æœºåçš„ç»å¤§å¤šæ•°æ—¶é—´ç³»ç»Ÿéƒ½åœ¨è¿è¡Œã€‚
å¦ä¸€ä¸ªä¾‹å­æ˜¯ç½‘ç»œæœåŠ¡å™¨ï¼Œä¸åœåœ°åœ¨è¿è¡Œï¼Œç­‰å¾…æ¥è‡ªç½‘ç»œçš„è¯·æ±‚ã€‚

%ğŸ% One of the simplest ways for programs to maintain their data
%ğŸ% is by reading and writing text files.  We have already seen
%ğŸ% programs that read text files; in this chapter we will see programs
%ğŸ% that write them.

ç¨‹åºä¿å­˜å…¶æ•°æ®çš„ä¸€ä¸ªæœ€ç®€å•æ–¹æ³•ï¼Œå°±æ˜¯è¯»å†™æ–‡æœ¬æ–‡ä»¶ã€‚
æˆ‘ä»¬å·²ç»æ¥è§¦è¿‡è¯»å–æ–‡æœ¬æ–‡ä»¶çš„ç¨‹åºï¼›åœ¨æœ¬ç« ï¼Œæˆ‘ä»¬å°†æ¥è§¦å†™å…¥æ–‡æœ¬çš„ç¨‹åºã€‚

%ğŸ% An alternative is to store the state of the program in a database.
%ğŸ% In this chapter I will present a simple database and a module,
%ğŸ% {\tt pickle}, that makes it easy to store program data.

å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨æ•°æ®åº“ä¿å­˜ç¨‹åºçš„çŠ¶æ€ã€‚æœ¬ç« æˆ‘å°†ä»‹ç»ä¸€ä¸ªç®€å•çš„æ•°æ®åº“ï¼Œ
ä»¥åŠç®€åŒ–å­˜å‚¨ç¨‹åºæ•°æ®è¿‡ç¨‹çš„ \li{pickle} æ¨¡å—ã€‚
\index{pickle module}  \index{module!pickle}


%ğŸ% \section{Reading and writing  |  è¯»å–å’Œå†™å…¥}
\section{è¯»å–å’Œå†™å…¥}
\index{file!reading and writing}

%ğŸ% A text file is a sequence of characters stored on a permanent
%ğŸ% medium like a hard drive, flash memory, or CD-ROM.  We saw how
%ğŸ% to open and read a file in Section~\ref{wordlist}.

æ–‡æœ¬æ–‡ä»¶æ˜¯å‚¨å­˜åœ¨ç±»ä¼¼ç¡¬ç›˜ã€é—ªå­˜ã€æˆ–è€…CD-ROMç­‰æ°¸ä¹…ä»‹è´¨ä¸Šçš„å­—ç¬¦åºåˆ—ã€‚
æˆ‘ä»¬åœ¨\ref{wordlist}~èŠ‚ä¸­æ¥è§¦äº†å¦‚ä½•æ‰“å¼€å’Œè¯»å–æ–‡ä»¶ã€‚
\index{open function}  \index{function!open}

%ğŸ% To write a file, you have to open it with mode \verb"'w'" as a second
%ğŸ% parameter:

è¦å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œä½ å¿…é¡»åœ¨æ‰“å¼€æ–‡ä»¶æ—¶è®¾ç½®ç¬¬äºŒä¸ªå‚æ•°æ¥ä¸º \li{'w'} æ¨¡å¼ï¼š

\begin{lstlisting}
>>> fout = open('output.txt', 'w')
\end{lstlisting}

%
%ğŸ% If the file already exists, opening it in write mode clears out
%ğŸ% the old data and starts fresh, so be careful!
%ğŸ% If the file doesn't exist, a new one is created.

å¦‚æœè¯¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆç”¨å†™å…¥æ¨¡å¼æ‰“å¼€å®ƒå°†ä¼šæ¸…ç©ºåŸæ¥çš„æ•°æ®å¹¶ä»æ–°å¼€å§‹ï¼Œæ‰€ä»¥è¦å°å¿ƒï¼
å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°†åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ã€‚

%ğŸ% {\tt open} returns a file object that provides methods for working
%ğŸ% with the file.
%ğŸ% The {\tt write} method puts data into the file.

\li{open} ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æä¾›äº†æ“ä½œæ–‡ä»¶çš„æ–¹æ³•ã€‚ \li{write} æ–¹æ³•å°†æ•°æ®å†™å…¥æ–‡ä»¶ã€‚

\begin{lstlisting}
>>> line1 = "This here's the wattle,\n"
>>> fout.write(line1)
24
\end{lstlisting}

%
%ğŸ% The return value is the number of characters that were written.
%ğŸ% The file object keeps track of where it is, so if
%ğŸ% you call {\tt write} again, it adds the new data to the end of
%ğŸ% the file.

è¿”å›å€¼æ˜¯è¢«å†™å…¥å­—ç¬¦çš„ä¸ªæ•°ã€‚æ–‡ä»¶å¯¹è±¡å°†è·Ÿè¸ªè‡ªèº«çš„ä½ç½®ï¼Œæ‰€ä»¥ä¸‹æ¬¡ä½ è°ƒç”¨ \li{write}çš„æ—¶å€™ï¼Œå®ƒä¼šåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ æ–°çš„æ•°æ®ã€‚

\begin{lstlisting}
>>> line2 = "the emblem of our land.\n"
>>> fout.write(line2)
24
\end{lstlisting}

%
%ğŸ% When you are done writing, you should close the file.

å®Œæˆæ–‡ä»¶å†™å…¥åï¼Œä½ åº”è¯¥å…³é—­æ–‡ä»¶ã€‚

\begin{lstlisting}
>>> fout.close()
\end{lstlisting}
%
\index{close method}
\index{method!close}

%
%ğŸ% If you don't close the file, it gets closed for you when the
%ğŸ% program ends.

å¦‚æœä½ ä¸å…³é—­è¿™ä¸ªæ–‡ä»¶ï¼Œç¨‹åºç»“æŸæ—¶å®ƒæ‰ä¼šå…³é—­ã€‚

%ğŸ% \section{Format operator  |  æ ¼å¼åŒ–è¿ç®—ç¬¦}
\section{æ ¼å¼åŒ–è¿ç®—ç¬¦}
\index{format operator}  \index{operator!format}

%ğŸ% The argument of {\tt write} has to be a string, so if we want
%ğŸ% to put other values in a file, we have to convert them to
%ğŸ% strings.  The easiest way to do that is with {\tt str}:

\li{write} çš„å‚æ•°å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦åœ¨æ–‡ä»¶ä¸­å†™å…¥å…¶å®ƒå€¼ï¼Œ
æˆ‘ä»¬éœ€è¦å…ˆå°†å®ƒä»¬è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚æœ€ç®€å•çš„æ³•æ˜¯ä½¿ç”¨ \li{str} ï¼š

\begin{lstlisting}
>>> x = 52
>>> fout.write(str(x))
\end{lstlisting}

%
%ğŸ% An alternative is to use the {\bf format operator}, {\tt \%}.  When
%ğŸ% applied to integers, {\tt \%} is the modulus operator.  But
%ğŸ% when the first operand is a string, {\tt \%} is the format operator.

å¦ä¸€ä¸ªæ–¹æ³•æ˜¯ä½¿ç”¨ {\em æ ¼å¼åŒ–è¿ç®—ç¬¦} (format operator)ï¼Œå³ \li{%}ã€‚
ä½œç”¨äºæ•´æ•°æ—¶ï¼Œ\li{%}
æ˜¯å–æ¨¡è¿ç®—ç¬¦ï¼Œè€Œå½“ç¬¬ä¸€ä¸ªè¿ç®—æ•°æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œ\li{%}
åˆ™æ˜¯æ ¼å¼åŒ–è¿ç®—ç¬¦ã€‚
\index{format string}

%ğŸ% The first operand is the {\bf format string}, which contains
%ğŸ% one or more {\bf format sequences}, which
%ğŸ% specify how
%ğŸ% the second operand is formatted.  The result is a string.

ç¬¬ä¸€ä¸ªè¿ç®—æ•°æ˜¯ {\em æ ¼å¼åŒ–å­—ç¬¦ä¸²} (format string)ï¼Œå®ƒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª {\em æ ¼å¼åŒ–åºåˆ—} (format sequence)ã€‚ æ ¼å¼åŒ–åºåˆ—æŒ‡å®šäº†ç¬¬äºŒä¸ªè¿ç®—æ•°æ˜¯å¦‚ä½•æ ¼å¼åŒ–çš„ã€‚ è¿ç®—ç»“æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
\index{format sequence}

%ğŸ% For example, the format sequence \verb"'%d'" means that
%ğŸ% the second operand should be formatted as a decimal
%ğŸ% integer:

ä¾‹å¦‚ï¼Œæ ¼å¼åŒ–åºåˆ— \li{'%d'}
æ„å‘³ç€ç¬¬äºŒä¸ªè¿ç®—æ•°åº”è¯¥è¢«æ ¼å¼åŒ–ä¸ºä¸€ä¸ªåè¿›åˆ¶æ•´æ•°ï¼š

\begin{lstlisting}
>>> camels = 42
>>> '%d' % camels
'42'
\end{lstlisting}

%
%ğŸ% The result is the string \verb"'42'", which is not to be confused
%ğŸ% with the integer value {\tt 42}.

ç»“æœæ˜¯å­—ç¬¦ä¸² \li{'42'} ï¼Œéœ€è¦å’Œæ•´æ•°å€¼ \li{42} åŒºåˆ†å¼€æ¥ã€‚

%ğŸ% A format sequence can appear anywhere in the string,
%ğŸ% so you can embed a value in a sentence:

ä¸€ä¸ªæ ¼å¼åŒ–åºåˆ—å¯ä»¥å‡ºç°åœ¨å­—ç¬¦ä¸²ä¸­çš„ä»»ä½•ä½ç½®ï¼Œæ‰€ä»¥å¯ä»¥å°†ä¸€ä¸ªå€¼åµŒå…¥åˆ°ä¸€ä¸ªè¯­å¥ä¸­ï¼š

\begin{lstlisting}
>>> 'I have spotted %d camels.' % camels
'I have spotted 42 camels.'
\end{lstlisting}

%
%ğŸ% If there is more than one format sequence in the string,
%ğŸ% the second argument has to be a tuple.  Each format sequence is
%ğŸ% matched with an element of the tuple, in order.

å¦‚æœå­—ç¬¦ä¸²ä¸­æœ‰å¤šä¸ªæ ¼å¼åŒ–åºåˆ—ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå…ƒç»„ã€‚
æ¯ä¸ªæ ¼å¼åŒ–åºåˆ—æŒ‰é¡ºåºå’Œå…ƒç»„ä¸­çš„å…ƒç´ å¯¹åº”ã€‚

%ğŸ% The following example uses \verb"'%d'" to format an integer,
%ğŸ% \verb"'%g'" to format a floating-point number, and
%ğŸ% \verb"'%s'" to format a string:

ä¸‹é¢çš„ä¾‹å­ä¸­ä½¿ç”¨ \li{'%d'}
æ¥æ ¼å¼åŒ–ä¸€ä¸ªæ•´æ•°ï¼Œ \li{'%g'}
æ¥æ ¼å¼åŒ–ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œä»¥åŠ \li{'%s'}
æ¥æ ¼å¼åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š

\begin{lstlisting}
>>> 'In %d years I have spotted %g %s.' % (3, 0.1, 'camels')
'In 3 years I have spotted 0.1 camels.'
\end{lstlisting}

%
%ğŸ% The number of elements in the tuple has to match the number
%ğŸ% of format sequences in the string.  Also, the types of the
%ğŸ% elements have to match the format sequences:

å…ƒç»„ä¸­å…ƒç´ çš„ä¸ªæ•°å¿…é¡»ç­‰äºå­—ç¬¦ä¸²ä¸­æ ¼å¼åŒ–åºåˆ—çš„ä¸ªæ•°ã€‚
åŒæ—¶ï¼Œå…ƒç´ çš„ç±»å‹ä¹Ÿå¿…é¡»ç¬¦åˆå¯¹åº”çš„æ ¼å¼åŒ–åºåˆ—ï¼š
\index{exception!TypeError}
\index{TypeError}

\begin{lstlisting}
>>> '%d %d %d' % (1, 2)
TypeError: not enough arguments for format string
>>> '%d' % 'dollars'
TypeError: %d format: a number is required, not str
\end{lstlisting}

%
%ğŸ% In the first example, there aren't enough elements; in the
%ğŸ% second, the element is the wrong type.

åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œå…ƒç»„ä¸­æ²¡æœ‰è¶³å¤Ÿçš„å…ƒç´ ï¼›åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œå…ƒç´ çš„ç±»å‹é”™è¯¯ã€‚

%ğŸ% For more information on the format operator, see
%ğŸ% \url{https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting}.  A more powerful alternative is the string
%ğŸ% format method, which you can read about at
%ğŸ% \url{https://docs.python.org/3/library/stdtypes.html#str.format}.

ä½ å¯ä»¥å‰å¾€ \href{https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting}{æ­¤å¤„} äº†è§£å…³äºæ ¼å¼åŒ–è¿ç®—ç¬¦çš„æ›´å¤šä¿¡æ¯ã€‚
ä¸€ä¸ªæ›´ä¸ºå¼ºå¤§çš„æ–¹æ³•æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²çš„ \li{format} æ–¹æ³•ï¼Œå¯ä»¥å‰å¾€ \href{https://docs.python.org/3/library/stdtypes.html#str.format}{æ­¤å¤„} äº†è§£ã€‚

% You can specify the number of digits as part of the format sequence.
% For example, the sequence \verb"'%8.2f'"
% formats a floating-point number to be 8 characters long, with
% 2 digits after the decimal point:

% % \begin{lstlisting}
% >>> '%8.2f' % 3.14159
% '    3.14'
% \end{lstlisting}
% \afterverb
% %
% The result takes up eight spaces with two
% digits after the decimal point.


%ğŸ% \section{Filenames and paths  |  æ–‡ä»¶åå’Œè·¯å¾„}
\section{æ–‡ä»¶åå’Œè·¯å¾„}
\label{paths}
\index{filename}  \index{path}
\index{directory}  \index{folder}

%ğŸ% Files are organized into {\bf directories} (also called ``folders'').
%ğŸ% Every running program has a ``current directory'', which is the
%ğŸ% default directory for most operations.
%ğŸ% For example, when you open a file for reading, Python looks for it in the
%ğŸ% current directory.

æ–‡ä»¶ä»¥ {\em ç›®å½•\footnote{ä¹Ÿç§°ä¸º``æ–‡ä»¶å¤¹ (folder)''}} (directory) çš„å½¢å¼ç»„ç»‡èµ·æ¥ã€‚
æ¯ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºéƒ½æœ‰ä¸€ä¸ª ``å½“å‰ç›®å½•\footnote{current directory}'' ä½œä¸ºå¤§å¤šæ•°æ“ä½œçš„é»˜è®¤ç›®å½•ã€‚
ä¾‹å¦‚ï¼Œå½“ä½ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ¥è¯»å–æ—¶ï¼ŒPython ä¼šåœ¨å½“å‰ç›®å½•ä¸‹å¯»æ‰¾è¿™ä¸ªæ–‡ä»¶ã€‚

\index{os module}  \index{module!os}

%ğŸ% The {\tt os} module provides functions for working with files and
%ğŸ% directories (``os'' stands for ``operating system'').  {\tt os.getcwd}
%ğŸ% returns the name of the current directory:

\li{os}\footnote{``os'' ä»£è¡¨ ``operating system''} æ¨¡å—æä¾›äº†æ“ä½œæ–‡ä»¶å’Œç›®å½•çš„å‡½æ•°ã€‚ \li{os.getcwd} è¿”å›å½“å‰ç›®å½•çš„åç§°ï¼š

\index{getcwd function}  \index{function!getcwd}

\begin{lstlisting}
>>> import os
>>> cwd = os.getcwd()
>>> cwd
'/home/dinsdale'
\end{lstlisting}

%
%ğŸ% {\tt cwd} stands for ``current working directory''.  The result in
%ğŸ% this example is {\tt /home/dinsdale}, which is the home directory of a
%ğŸ% user named {\tt dinsdale}.
%ğŸ%
%ğŸ% \li{cwd} ä»£è¡¨ ``current working directory''ï¼Œå³ ``å½“å‰å·¥ä½œç›®å½•''ã€‚
%ğŸ% åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿”å›çš„ç»“æœæ˜¯ \li{/home/dinsdale} ï¼Œå³ç”¨æˆ·åä¸º ``dinsdale'' çš„ä¸»ç›®å½•ã€‚

\index{working directory}  \index{directory!working}

%ğŸ% A string like \verb"'/home/dinsdale'" that identifies a file or
%ğŸ% directory is called a {\bf path}.

ç±»ä¼¼ \li{'/home/dinsdale'} è¿™æ ·çš„å­—ç¬¦ä¸²æŒ‡æ˜ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œ å«åš {\em è·¯å¾„} (path) ã€‚

%ğŸ% A simple filename, like {\tt memo.txt} is also considered a path,
%ğŸ% but it is a {\bf relative path} because it relates to the current
%ğŸ% directory.  If the current directory is {\tt /home/dinsdale}, the
%ğŸ% filename {\tt memo.txt} would refer to {\tt /home/dinsdale/memo.txt}.

ä¸€ä¸ªç®€å•çš„æ–‡ä»¶åï¼Œå¦‚ \li{memo.txt} ï¼ŒåŒæ ·è¢«çœ‹åšæ˜¯ä¸€ä¸ªè·¯å¾„ï¼Œåªä¸è¿‡æ˜¯ {\em ç›¸å¯¹è·¯å¾„} (relative path) ï¼Œå› ä¸ºå®ƒæ˜¯ç›¸å¯¹äºå½“å‰ç›®å½•è€Œè¨€çš„ã€‚å¦‚æœå½“å‰ç›®å½•æ˜¯ \li{/home/dinsdale} ï¼Œé‚£ä¹ˆæ–‡ä»¶å \li{memo.txt} å°±ä»£è¡¨ \li{/home/dinsdale/memo.txt} ã€‚

\index{relative path} \index{path!relative}
\index{absolute path} \index{path!absolute}

%ğŸ% A path that begins with {\tt /} does not depend on the current
%ğŸ% directory; it is called an {\bf absolute path}.  To find the absolute
%ğŸ% path to a file, you can use {\tt os.path.abspath}:

ä¸€ä¸ªä»¥ \li{/} å¼€å¤´çš„è·¯å¾„å’Œå½“å‰ç›®å½•æ— å…³ï¼Œå«åš {\em ç»å¯¹è·¯å¾„} (absolute path)ã€‚ è¦è·å¾—ä¸€ä¸ªæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œä½ å¯ä»¥ä½¿ç”¨ \li{os.path.abspath} ï¼š

\begin{lstlisting}
>>> os.path.abspath('memo.txt')
'/home/dinsdale/memo.txt'
\end{lstlisting}

%
%ğŸ% {\tt os.path} provides other functions for working with filenames
%ğŸ% and paths.  For example,
%ğŸ% {\tt os.path.exists} checks
%ğŸ% whether a file or directory exists:

\li{os.path} è¿˜æä¾›äº†å…¶å®ƒå‡½æ•°æ¥å¯¹æ–‡ä»¶åå’Œè·¯å¾„è¿›è¡Œæ“ä½œã€‚  ä¾‹å¦‚ï¼Œ\li{os.path.exists} æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•æ˜¯å¦å­˜åœ¨ï¼š

\index{exists function}  \index{function!exists}

\begin{lstlisting}
>>> os.path.exists('memo.txt')
True
\end{lstlisting}

%
%ğŸ% If it exists, {\tt os.path.isdir} checks whether it's a directory:

å¦‚æœå­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡ \li{os.path.isdir} æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªç›®å½•ï¼š

\begin{lstlisting}
>>> os.path.isdir('memo.txt')
False
>>> os.path.isdir('/home/dinsdale')
True
\end{lstlisting}

%
%ğŸ% Similarly, {\tt os.path.isfile} checks whether it's a file.

ç±»ä¼¼çš„ï¼Œ \li{os.path.isfile} æ£€æŸ¥å®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªæ–‡ä»¶ã€‚

%ğŸ% {\tt os.listdir} returns a list of the files (and other directories)
%ğŸ% in the given directory:

\li{os.listdir} è¿”å›ç»™å®šç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨(ä»¥åŠå…¶å®ƒç›®å½•)ã€‚

\begin{lstlisting}
>>> os.listdir(cwd)
['music', 'photos', 'memo.txt']
\end{lstlisting}

%
%ğŸ% To demonstrate these functions, the following example
%ğŸ% ``walks'' through a directory, prints
%ğŸ% the names of all the files, and calls itself recursively on
%ğŸ% all the directories.

æ¥ä¸‹æ¥æ¼”ç¤ºä¸‹ä»¥ä¸Šå‡½æ•°çš„ä½¿ç”¨ã€‚ ä¸‹é¢çš„ä¾‹å­ ``éå†''ä¸€ä¸ªç›®å½•ï¼Œ æ‰“å°æ‰€æœ‰æ–‡ä»¶çš„åå­—ï¼Œå¹¶ä¸”é’ˆå¯¹å…¶ä¸­æ‰€æœ‰çš„ç›®å½•é€’å½’çš„è°ƒç”¨è‡ªèº«ã€‚

\index{walk, directory}  \index{directory!walk}

\begin{lstlisting}
def walk(dirname):
    for name in os.listdir(dirname):
        path = os.path.join(dirname, name)

        if os.path.isfile(path):
            print(path)
        else:
            walk(path)
\end{lstlisting}

%
%ğŸ% {\tt os.path.join} takes a directory and a file name and joins
%ğŸ% them into a complete path.

\li{os.path.join} æ¥å—ä¸€ä¸ªç›®å½•å’Œä¸€ä¸ªæ–‡ä»¶åï¼Œå¹¶æŠŠå®ƒä»¬åˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„è·¯å¾„ã€‚

%ğŸ% The {\tt os} module provides a function called {\tt walk} that is
%ğŸ% similar to this one but more versatile.  As an exercise, read the
%ğŸ% documentation and use it to print the names of the files in a given
%ğŸ% directory and its subdirectories.  You can download my solution from
%ğŸ% \url{http://thinkpython2.com/code/walk.py}.

osæ¨¡å—æä¾›äº†ä¸€ä¸ªå«åš \li{walk} çš„å‡½æ•°ï¼Œå’Œæˆ‘ä»¬ä¸Šé¢å†™çš„ç±»ä¼¼ï¼Œä½†æ˜¯åŠŸèƒ½æ›´åŠ æ›´å¯Œã€‚
ä½œä¸ºç»ƒä¹ ï¼Œé˜…è¯»æ–‡æ¡£å¹¶ä¸”ä½¿ç”¨ \li{walk} æ‰“å°å‡ºç»™å®šç›®å½•ä¸‹çš„æ–‡ä»¶åå’Œå­ç›®å½•ã€‚
ä½ å¯ä»¥åœ¨ \href{http://thinkpython2.com/code/walk.py}{æ­¤å¤„} ä¸‹è½½æˆ‘çš„ç­”æ¡ˆã€‚


%ğŸ% \section{Catching exceptions  |  æ•è·å¼‚å¸¸}
\section{æ•è·å¼‚å¸¸}
\label{catch}

%ğŸ% A lot of things can go wrong when you try to read and write
%ğŸ% files.  If you try to open a file that doesn't exist, you get an
%ğŸ% {\tt IOError}:

è¯•å›¾è¯»å†™æ–‡ä»¶æ—¶ï¼Œå¾ˆå¤šåœ°æ–¹å¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ã€‚å¦‚æœä½ è¯•å›¾æ‰“å¼€ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶å¤¹ï¼Œ
ä¼šå¾—åˆ°ä¸€ä¸ª{\bf è¾“å…¥è¾“å‡ºé”™è¯¯} (\li{IOError})ï¼š

\index{open function}  \index{function!open}
\index{exception!IOError}  \index{IOError}

\begin{lstlisting}
>>> fin = open('bad_file')
IOError: [Errno 2] No such file or directory: 'bad_file'
\end{lstlisting}

%
%ğŸ% If you don't have permission to access a file:

å¦‚æœä½ æ²¡æœ‰æƒé™è®¿é—®ä¸€ä¸ªæ–‡ä»¶ï¼š

\index{file!permission}  \index{permission, file}

\begin{lstlisting}
>>> fout = open('/etc/passwd', 'w')
PermissionError: [Errno 13] Permission denied: '/etc/passwd'
\end{lstlisting}

%
%ğŸ% And if you try to open a directory for reading, you get

å¦‚æœä½ è¯•å›¾æ‰“å¼€ä¸€ä¸ªç›®å½•æ¥è¯»å–ï¼Œä½ ä¼šå¾—åˆ°ï¼š

\begin{lstlisting}
>>> fin = open('/home')
IsADirectoryError: [Errno 21] Is a directory: '/home'
\end{lstlisting}

%
%ğŸ% To avoid these errors, you could use functions like {\tt os.path.exists}
%ğŸ% and {\tt os.path.isfile}, but it would take a lot of time and code
%ğŸ% to check all the possibilities (if ``{\tt Errno 21}'' is any
%ğŸ% indication, there are at least 21 things that can go wrong).

ä¸ºäº†é¿å…è¿™äº›é”™è¯¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ç±»ä¼¼ \li{os.path.exists} å’Œ \li{os.path.isfile} çš„å‡½æ•°æ¥æ£€æŸ¥ï¼Œä½†è¿™å°†ä¼šè€—è´¹å¤§é‡çš„æ—¶é—´å’Œä»£ç å»æ£€æŸ¥æ‰€æœ‰çš„å¯èƒ½æ€§(ä» ``\li{Errno 21}''è¿™ä¸ªé”™è¯¯ä¿¡æ¯æ¥çœ‹ï¼Œè‡³å°‘æœ‰ 21 ç§å¯èƒ½å‡ºé”™çš„æƒ…å†µ)ã€‚

\index{exception, catching}  \index{try statement}
\index{statement!try}

%ğŸ% It is better to go ahead and try---and deal with problems if they
%ğŸ% happen---which is exactly what the {\tt try} statement does.  The
%ğŸ% syntax is similar to an {\tt if...else} statement:

æ›´å¥½çš„åŠæ³•æ˜¯åœ¨é—®é¢˜å‡ºç°çš„æ—¶å€™æ‰å»å¤„ç†ï¼Œè€Œè¿™æ­£æ˜¯ \li{try} è¯­å¥åšçš„äº‹æƒ…ã€‚
å®ƒçš„è¯­æ³•ç±»ä¼¼ \li{if...else} è¯­å¥ï¼š

\begin{lstlisting}
try:
    fin = open('bad_file')
except:
    print('Something went wrong.')
\end{lstlisting}

%
%ğŸ% Python starts by executing the {\tt try} clause.  If all goes
%ğŸ% well, it skips the {\tt except} clause and proceeds.  If an
%ğŸ% exception occurs, it jumps out of the {\tt try} clause and
%ğŸ% runs the {\tt except} clause.

Python ä» \li{try} å­å¥\footnote{clause} å¼€å§‹æ‰§è¡Œã€‚
å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œé‚£ä¹ˆ \li{except} å­å¥å°†è¢«è·³è¿‡ã€‚
å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™è·³å‡º \li{try} å­å¥ï¼Œæ‰§è¡Œ \li{except} å­å¥ã€‚

%ğŸ% Handling an exception with a {\tt try} statement is called {\bf
%ğŸ% catching} an exception.  In this example, the {\tt except} clause
%ğŸ% prints an error message that is not very helpful.  In general,
%ğŸ% catching an exception gives you a chance to fix the problem, or try
%ğŸ% again, or at least end the program gracefully.

ä½¿ç”¨ \li{try} è¯­å¥å¤„ç†å¼‚å¸¸è¢«ç§°ä¸ºæ˜¯ {\em æ•è·} (catching) å¼‚å¸¸ã€‚
åœ¨æœ¬ä¾‹ä¸­ï¼Œ\li{except} å­å¥æ‰“å°å‡ºä¸€ä¸ªå¹¶éå¾ˆæœ‰å¸®åŠ©çš„é”™è¯¯ä¿¡æ¯ã€‚
ä¸€èˆ¬æ¥è¯´ï¼Œæ•è·å¼‚å¸¸åä½ å¯ä»¥é€‰æ‹©æ˜¯å¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ–è€…ç»§ç»­å°è¯•è¿è¡Œï¼Œåˆæˆ–è€…è‡³å°‘ä¼˜é›…åœ°ç»“æŸç¨‹åºã€‚


%ğŸ% \section{Databases  |  æ•°æ®åº“}
\section{æ•°æ®åº“}
\index{database}  \index{æ•°æ®åº“}

%ğŸ% A {\bf database} is a file that is organized for storing data.  Many
%ğŸ% databases are organized like a dictionary in the sense that they map
%ğŸ% from keys to values.  The biggest difference between a database and a
%ğŸ% dictionary is that the database is on disk (or other permanent
%ğŸ% storage), so it persists after the program ends.

{\em æ•°æ®åº“} æ˜¯ä¸€ä¸ªç”¨æ¥å­˜å‚¨æ•°æ®çš„æ–‡ä»¶ã€‚
å¤§å¤šæ•°çš„æ•°æ®åº“é‡‡ç”¨ç±»ä¼¼å­—å…¸çš„å½¢å¼ï¼Œå³å°†é”®æ˜ å°„åˆ°å€¼ã€‚
æ•°æ®åº“å’Œå­—å…¸çš„æœ€å¤§åŒºåˆ«æ˜¯ï¼Œæ•°æ®åº“æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Š(æˆ–è€…å…¶ä»–æ°¸ä¹…å­˜å‚¨ä¸­)ï¼Œ
æ‰€ä»¥å³ä½¿ç¨‹åºç»“æŸï¼Œå®ƒä»¬ä¾ç„¶å­˜åœ¨ã€‚

\index{dbm module} \index{module!dbm}

%ğŸ% The module {\tt dbm} provides an interface for creating
%ğŸ% and updating database files.
%ğŸ% As an example, I'll create a database
%ğŸ% that contains captions for image files.

\li{dbm} æ¨¡å—æä¾›äº†ä¸€ä¸ªåˆ›å»ºå’Œæ›´æ–°æ•°æ®åº“æ–‡ä»¶çš„æ¥å£ã€‚
ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘æ¥ä¸‹æ¥åˆ›å»ºå»ºä¸€ä¸ªåŒ…å«å›¾ç‰‡æ–‡ä»¶æ ‡é¢˜çš„æ•°æ®åº“ã€‚

\index{open function}  \index{function!open}

%ğŸ% Opening a database is similar to opening other files:

æ‰“å¼€æ•°æ®åº“å’Œæ‰“å¼€å…¶å®ƒæ–‡ä»¶çš„æ–¹æ³•ç±»ä¼¼ï¼š

\begin{lstlisting}
>>> import dbm
>>> db = dbm.open('captions', 'c')
\end{lstlisting}

%
%ğŸ% The mode \verb"'c'" means that the database should be created if
%ğŸ% it doesn't already exist.  The result is a database object
%ğŸ% that can be used (for most operations) like a dictionary.

æ¨¡å¼ \li{'c'} ä»£è¡¨å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨åˆ™åˆ›å»ºè¯¥æ•°æ®åº“ã€‚
è¿™ä¸ªæ“ä½œè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°æ®åº“å¯¹è±¡ï¼Œå¯ä»¥åƒå­—å…¸ä¸€æ ·ä½¿ç”¨å®ƒ(å¯¹äºå¤§å¤šæ•°æ“ä½œ)ã€‚

\index{database object}  \index{object!database}

%ğŸ% When you create a new item, {\tt dbm} updates the database file.

å½“ä½ åˆ›å»ºä¸€ä¸ªæ–°é¡¹æ—¶ï¼Œ\li{dbm} å°†æ›´æ–°æ•°æ®åº“æ–‡ä»¶ã€‚

\index{update!database}

\begin{lstlisting}
>>> db['cleese.png'] = 'Photo of John Cleese.'
\end{lstlisting}

%
%ğŸ% When you access one of the items, {\tt dbm} reads the file:

å½“ä½ è®¿é—®æŸä¸ªé¡¹æ—¶ï¼Œ\li{dbm} å°†è¯»å–æ–‡ä»¶ï¼š

\begin{lstlisting}
>>> db['cleese.png']
b'Photo of John Cleese.'
\end{lstlisting}

%
%ğŸ% The result is a {\bf bytes object}, which is why it begins with {\tt
%ğŸ%   b}.  A bytes object is similar to a string in many ways.  When you
%ğŸ% get farther into Python, the difference becomes important, but for now
%ğŸ% we can ignore it.

è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ª {\em å­—èŠ‚å¯¹è±¡} (bytes object) ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆç»“æœä»¥ \li{b} å¼€å¤´ã€‚
ä¸€ä¸ªå­—èŠ‚å¯¹è±¡åœ¨å¾ˆå¤šæ–¹é¢éƒ½å’Œä¸€ä¸ªå­—ç¬¦ä¸²å¾ˆåƒã€‚ä½†æ˜¯å½“ä½ æ·±å…¥äº†è§£ Python æ—¶ï¼Œ
å®ƒä»¬ä¹‹é—´çš„å·®åˆ«ä¼šå˜å¾—å¾ˆé‡è¦ï¼Œä½†æ˜¯ç›®å‰æˆ‘ä»¬å¯ä»¥å¿½ç•¥æ‰é‚£äº›å·®åˆ«ã€‚

\index{bytes object}  \index{object!bytes}

%ğŸ% If you make another assignment to an existing key, {\tt dbm} replaces
%ğŸ% the old value:

å¦‚æœä½ å¯¹å·²æœ‰çš„é”®å†æ¬¡è¿›è¡Œèµ‹å€¼ï¼Œ\li{dbm} å°†æŠŠæ—§çš„å€¼æ›¿æ¢æ‰ï¼š


\begin{lstlisting}
>>> db['cleese.png'] = 'Photo of John Cleese doing a silly walk.'
>>> db['cleese.png']
b'Photo of John Cleese doing a silly walk.'
\end{lstlisting}
%

%ğŸ% Some dictionary methods, like {\tt keys} and {\tt items}, don't
%ğŸ% work with database objects.  But iteration with a {\tt for}
%ğŸ% loop works:

ä¸€äº›å­—å…¸æ–¹æ³•ï¼Œä¾‹å¦‚ \li{keys} å’Œ \li{items} ï¼Œä¸é€‚ç”¨äºæ•°æ®åº“å¯¹è±¡ï¼Œä½†æ˜¯ \li{for} å¾ªç¯ä¾ç„¶é€‚ç”¨ï¼š
\index{dictionary methods!dbm module}

\begin{lstlisting}
for key in db:
    print(key, db[key])
\end{lstlisting}

%
%ğŸ% As with other files, you should close the database when you are
%ğŸ% done:

ä¸å…¶å®ƒæ–‡ä»¶ä¸€æ ·ï¼Œå½“ä½ å®Œæˆæ“ä½œåéœ€è¦å…³é—­æ–‡ä»¶ï¼š

\begin{lstlisting}
>>> db.close()
\end{lstlisting}
%
\index{close method}  \index{method!close}


%ğŸ% \section{Pickling  |  åºåˆ—åŒ–}
\section{åºåˆ—åŒ–}
\index{pickling}

%ğŸ% A limitation of {\tt dbm} is that the keys and values have to be
%ğŸ% strings or bytes.  If you try to use any other type, you get an error.

\li{dbm} çš„ä¸€ä¸ªé™åˆ¶åœ¨äºé”®å’Œå€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–è€…å­—èŠ‚ã€‚
å¦‚æœä½ å°è¯•å»ç”¨å…¶å®ƒæ•°æ®ç±»å‹ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚
\index{pickle module} \index{module!pickle}

%ğŸ% The {\tt pickle} module can help.  It translates
%ğŸ% almost any type of object into a string suitable for storage in a
%ğŸ% database, and then translates strings back into objects.

\li{pickle} æ¨¡å—å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒèƒ½å°†å‡ ä¹æ‰€æœ‰ç±»å‹çš„å¯¹è±¡è½¬åŒ–ä¸ºé€‚åˆåœ¨æ•°æ®åº“ä¸­å­˜å‚¨çš„å­—ç¬¦ä¸²ï¼Œä»¥åŠå°†é‚£äº›å­—ç¬¦ä¸²è¿˜åŸä¸ºåŸæ¥çš„å¯¹è±¡ã€‚

%ğŸ% {\tt pickle.dumps} takes an object as a parameter and returns
%ğŸ% a string representation ({\tt dumps} is short for ``dump string''):

\li{pickle.dumps} è¯»å–ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤º( \li{dumps} æ˜¯ ``dump string'' çš„ç¼©å†™)ï¼š

\begin{lstlisting}
>>> import pickle
>>> t = [1, 2, 3]
>>> pickle.dumps(t)
b'\x80\x03]q\x00(K\x01K\x02K\x03e.'
\end{lstlisting}

%
%ğŸ% The format isn't obvious to human readers; it is meant to be
%ğŸ% easy for {\tt pickle} to interpret.  {\tt pickle.loads}
%ğŸ% (``load string'') reconstitutes the object:

è¿™ä¸ªæ ¼å¼å¯¹äººç±»æ¥è¯´ä¸æ˜¯å¾ˆç›´è§‚ï¼Œä½†æ˜¯å¯¹ \li{pickle} æ¥è¯´å¾ˆå®¹æ˜“å»è§£é‡Šã€‚ \li{pickle.loads} (``load string'') å¯ä»¥é‡å»ºå¯¹è±¡ï¼š

\begin{lstlisting}
>>> t1 = [1, 2, 3]
>>> s = pickle.dumps(t1)
>>> t2 = pickle.loads(s)
>>> t2
[1, 2, 3]
\end{lstlisting}

%
%ğŸ% Although the new object has the same value as the old, it is
%ğŸ% not (in general) the same object:

å°½ç®¡æ–°å¯¹è±¡å’Œæ—§å¯¹è±¡æœ‰ç›¸åŒçš„å€¼ï¼Œä½†å®ƒä»¬(ä¸€èˆ¬æ¥è¯´)ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼š

\begin{lstlisting}
>>> t1 == t2
True
>>> t1 is t2
False
\end{lstlisting}

%
%ğŸ% In other words, pickling and then unpickling has the same effect
%ğŸ% as copying the object.

æ¢è¨€ä¹‹ï¼Œåºåˆ—åŒ–ç„¶åååºåˆ—åŒ–ç­‰æ•ˆäºå¤åˆ¶ä¸€ä¸ªå¯¹è±¡ã€‚

%ğŸ% You can use {\tt pickle} to store non-strings in a database.
%ğŸ% In fact, this combination is so common that it has been
%ğŸ% encapsulated in a module called {\tt shelve}.

ä½ å¯ä»¥ä½¿ç”¨ \li{pickle} å°†éå­—ç¬¦ä¸²å¯¹è±¡å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚
äº‹å®ä¸Šï¼Œè¿™ä¸ªç»„åˆéå¸¸å¸¸ç”¨ï¼Œå·²ç»è¢«å°è£…è¿›äº†æ¨¡å— \li{shelve} ä¸­ã€‚

\index{shelve module}  \index{module!shelve}

%ğŸ% \section{Pipes  |  ç®¡é“}
\section{ç®¡é“}
\index{shell}  \index{pipe}

%ğŸ% Most operating systems provide a command-line interface,
%ğŸ% also known as a {\bf shell}.  Shells usually provide commands
%ğŸ% to navigate the file system and launch applications.  For
%ğŸ% example, in Unix you can change directories with {\tt cd},
%ğŸ% display the contents of a directory with {\tt ls}, and launch
%ğŸ% a web browser by typing (for example) {\tt firefox}.

å¤§å¤šæ•°çš„æ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œçš„æ¥å£ï¼Œä¹Ÿè¢«ç§°ä¸º {\em shell} ã€‚
shell é€šå¸¸æä¾›æµè§ˆæ–‡ä»¶ç³»ç»Ÿå’Œå¯åŠ¨ç¨‹åºçš„å‘½ä»¤ã€‚
ä¾‹å¦‚ï¼Œåœ¨ Unix ç³»ç»Ÿä¸­ä½ å¯ä»¥ä½¿ç”¨ \li{cd} æ”¹å˜ç›®å½•ï¼Œä½¿ç”¨ \li{ls} æ˜¾ç¤ºä¸€ä¸ªç›®å½•çš„å†…å®¹ï¼Œ
é€šè¿‡è¾“å…¥ \li{firefox} (ä¸¾ä¾‹æ¥è¯´)æ¥å¯åŠ¨ä¸€ä¸ªç½‘é¡µæµè§ˆå™¨ã€‚

\index{ls (Unix command)}  \index{Unix command!ls}

%ğŸ% Any program that you can launch from the shell can also be
%ğŸ% launched from Python using a {\bf pipe object}, which
%ğŸ% represents a running program.

ä»»ä½•å¯ä»¥åœ¨shellä¸­å¯åŠ¨çš„ç¨‹åºï¼Œä¹Ÿå¯ä»¥åœ¨ Python ä¸­é€šè¿‡ä½¿ç”¨ {\em ç®¡é“å¯¹è±¡} (pipe object) æ¥å¯åŠ¨ã€‚ ä¸€ä¸ªç®¡é“ä»£è¡¨ç€ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºã€‚

%ğŸ% For example, the Unix command {\tt ls -l} normally displays the
%ğŸ% contents of the current directory in long format.  You can
%ğŸ% launch {\tt ls} with {\tt os.popen}\footnote{{\tt popen} is deprecated
%ğŸ% now, which means we are supposed to stop using it and start using
%ğŸ% the {\tt subprocess} module.  But for simple cases, I find
%ğŸ% {\tt subprocess} more complicated than necessary.  So I am going
%ğŸ% to keep using {\tt popen} until they take it away.}:

ä¾‹å¦‚ï¼ŒUnix å‘½ä»¤ \li{ls -l} å°†ä»¥è¯¦ç»†æ ¼å¼æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹çš„å†…å®¹ã€‚
ä½ å¯ä»¥ä½¿ç”¨ \li{os.popen} æ¥å¯åŠ¨ \li{ls} ï¼š

\index{popen function}  \index{function!popen}

\begin{lstlisting}
>>> cmd = 'ls -l'
>>> fp = os.popen(cmd)
\end{lstlisting}

%
%ğŸ% The argument is a string that contains a shell command.  The
%ğŸ% return value is an object that behaves like an open
%ğŸ% file.  You can read the output from the {\tt ls} process one
%ğŸ% line at a time with {\tt readline} or get the whole thing at
%ğŸ% once with {\tt read}:

å®å‚æ˜¯ä¸€ä¸ªåŒ…å«shellå‘½ä»¤çš„å­—ç¬¦ä¸²ã€‚è¿”å›å€¼æ˜¯ä¸€ä¸ªè¡Œä¸ºç±»ä¼¼å·²æ‰“å¼€æ–‡ä»¶çš„å¯¹è±¡ã€‚
ä½ å¯ä»¥ä½¿ç”¨ \li{readline} æ¥æ¯æ¬¡ä» \li{ls} è¿›ç¨‹çš„è¾“å‡ºä¸­è¯»å–ä¸€è¡Œï¼Œæˆ–è€…ä½¿ç”¨ \li{read} æ¥ä¸€æ¬¡è¯»å–æ‰€æœ‰å†…å®¹ï¼š

\index{readline method}  \index{method!readline}
\index{read method}  \index{method!read}

\begin{lstlisting}
>>> res = fp.read()
\end{lstlisting}

%
%ğŸ% When you are done, you close the pipe like a file:

å½“ä½ å®Œæˆæ“ä½œåï¼Œåƒå…³é—­ä¸€ä¸ªæ–‡ä»¶ä¸€æ ·å…³é—­ç®¡é“ï¼š

\index{close method}  \index{method!close}

\begin{lstlisting}
>>> stat = fp.close()
>>> print(stat)
None
\end{lstlisting}

%
%ğŸ% The return value is the final status of the {\tt ls} process;
%ğŸ% {\tt None} means that it ended normally (with no errors).

è¿”å›å€¼æ˜¯ \li{ls} è¿›ç¨‹çš„æœ€ç»ˆçŠ¶æ€ã€‚ \li{None} è¡¨ç¤ºæ­£å¸¸ç»“æŸ(æ²¡æœ‰å‡ºç°é”™è¯¯)ã€‚

%ğŸ% For example, most Unix systems provide a command called {\tt md5sum}
%ğŸ% that reads the contents of a file and computes a ``checksum''.
%ğŸ% You can read about MD5 at \url{http://en.wikipedia.org/wiki/Md5}.  This
%ğŸ% command provides an efficient way to check whether two files
%ğŸ% have the same contents.  The probability that different contents
%ğŸ% yield the same checksum is very small (that is, unlikely to happen
%ğŸ% before the universe collapses).

ä¾‹å¦‚ï¼Œå¤§å¤šæ•° Unix ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªå«åš \li{md5sum} çš„å‘½ä»¤ï¼Œæ¥è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹å¹¶è®¡ç®—å‡ºä¸€ä¸ª ``æ ¡éªŒå’Œ (checksum)''ã€‚
ä½ å¯ä»¥åœ¨ \href{http://en.wikipedia.org/wiki/Md5}{ç»´åŸºç™¾ç§‘} ä¸­äº†è§£æ›´å¤š MD5 çš„ä¿¡æ¯ã€‚
ä¸åŒçš„å†…å®¹äº§ç”Ÿç›¸åŒæ ¡éªŒå’Œçš„æ¦‚ç‡éå¸¸å°(ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å®‡å®™åå¡Œä¹‹å‰ä¸ä¼šå‘ç”Ÿ)ã€‚
\index{md5}  \index{checksum}

\index{ç»´åŸºç™¾ç§‘}


%ğŸ% You can use a pipe to run {\tt md5sum} from Python and get the result:

ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®¡é“æ¥ä» Python ä¸­è¿è¡Œ \li{md5sum} ï¼Œå¹¶å¾—åˆ°è®¡ç®—ç»“æœï¼š

\begin{lstlisting}
>>> filename = 'book.tex'
>>> cmd = 'md5sum ' + filename
>>> fp = os.popen(cmd)
>>> res = fp.read()
>>> stat = fp.close()
>>> print(res)
1e0033f0ed0656636de0d75144ba32e0  book.tex
>>> print(stat)
None
\end{lstlisting}


%ğŸ% \section{Writing modules  |  ç¼–å†™æ¨¡å—}
\section{ç¼–å†™æ¨¡å—}
\label{modules}
\index{module, writing}
\index{word count}

%ğŸ% Any file that contains Python code can be imported as a module.
%ğŸ% For example, suppose you have a file named {\tt wc.py} with the following
%ğŸ% code:

ä»»ä½•åŒ…å« Python ä»£ç çš„æ–‡ä»¶ï¼Œéƒ½å¯ä»¥ä½œä¸ºæ¨¡å—è¢«å¯¼å…¥ã€‚
ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰åŒ…å«ä»¥ä¸‹ä»£ç çš„æ–‡ä»¶ \li{wc.py} ï¼š

\begin{lstlisting}
def linecount(filename):
    count = 0
    for line in open(filename):
        count += 1
    return count

print(linecount('wc.py'))
\end{lstlisting}

%
%ğŸ% If you run this program, it reads itself and prints the number
%ğŸ% of lines in the file, which is 7.
%ğŸ% You can also import it like this:

å¦‚æœä½ è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œå®ƒå°†è¯»å–è‡ªèº«å¹¶æ‰“å°æ–‡ä»¶çš„è¡Œæ•°ï¼Œç»“æœæ˜¯ 7 ã€‚
ä½ ä¹Ÿå¯ä»¥è¿™æ ·å¯¼å…¥æ¨¡å—ï¼š

\begin{lstlisting}
>>> import wc
7
\end{lstlisting}

%
%ğŸ% Now you have a module object {\tt wc}:

ç°åœ¨ä½ æœ‰äº†ä¸€ä¸ªæ¨¡å—å¯¹è±¡ \li{wc} ï¼š

\index{module object}  \index{object!module}

\begin{lstlisting}
>>> wc
<module 'wc' from 'wc.py'>
\end{lstlisting}

%
%ğŸ% The module object provides \verb"linecount":

è¿™ä¸ªæ¨¡å—å¯¹è±¡æä¾›äº† \li{linecount} å‡½æ•°ï¼š

\begin{lstlisting}
>>> wc.linecount('wc.py')
7
\end{lstlisting}

%
%ğŸ% So that's how you write modules in Python.

ä»¥ä¸Šå°±æ˜¯å¦‚ä½•ç¼–å†™ Python æ¨¡å—çš„æ–¹æ³•ã€‚

%ğŸ% The only problem with this example is that when you import
%ğŸ% the module it runs the test code at the bottom.  Normally
%ğŸ% when you import a module, it defines new functions but it
%ğŸ% doesn't run them.

è¿™ä¸ªä¾‹å­ä¸­å”¯ä¸€çš„é—®é¢˜åœ¨äºï¼Œå½“ä½ å¯¼å…¥æ¨¡å—åï¼Œå®ƒå°†è‡ªåŠ¨è¿è¡Œæœ€åé¢çš„æµ‹è¯•ä»£ç ã€‚
é€šå¸¸å½“å¯¼å…¥ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œå®ƒå°†å®šä¹‰ä¸€äº›æ–°çš„å‡½æ•°ï¼Œä½†æ˜¯å¹¶ä¸è¿è¡Œå®ƒä»¬ã€‚

\index{import statement}  \index{statement!import}

%ğŸ% Programs that will be imported as modules often
%ğŸ% use the following idiom:

ä½œä¸ºæ¨¡å—çš„ç¨‹åºé€šå¸¸å†™æˆä»¥ä¸‹ç»“æ„ï¼š

\begin{lstlisting}
if __name__ == '__main__':
    print(linecount('wc.py'))
\end{lstlisting}

%
%ğŸ% \verb"__name__" is a built-in variable that is set when the
%ğŸ% program starts.  If the program is running as a script,
%ğŸ% \verb"__name__" has the value \verb"'__main__'"; in that
%ğŸ% case, the test code runs.  Otherwise,
%ğŸ% if the module is being imported, the test code is skipped.

\li{__name__} æ˜¯ä¸€ä¸ªåœ¨ç¨‹åºå¼€å§‹æ—¶è®¾ç½®å¥½çš„å†…å»ºå˜é‡ã€‚
å¦‚æœç¨‹åºä»¥è„šæœ¬çš„å½¢å¼è¿è¡Œï¼Œ\li{__name__} çš„å€¼ä¸º \li{__main__} ï¼Œè¿™æ—¶å…¶ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œã€‚å¦åˆ™å½“è¢«ä½œä¸ºæ¨¡å—å¯¼å…¥æ—¶ï¼Œå…¶ä¸­çš„ä»£ç å°†è¢«è·³è¿‡ã€‚

%ğŸ% As an exercise, type this example into a file named {\tt wc.py} and run
%ğŸ% it as a script.  Then run the Python interpreter and
%ğŸ% {\tt import wc}.  What is the value of \verb"__name__"
%ğŸ% when the module is being imported?

æˆ‘ä»¬åšä¸ªç»ƒä¹ ï¼Œå°†ä¾‹å­è¾“å…¥åˆ°æ–‡ä»¶ \li{wc.py} ä¸­ï¼Œç„¶åä»¥è„šæœ¬å½¢å¼è¿è¡Œå®ƒã€‚
æ¥ç€ï¼Œæ‰“å¼€ Python è§£é‡Šå™¨å¹¶å¯¼å…¥ \li{wc} ã€‚å½“æ¨¡å—è¢«å¯¼å…¥åï¼Œ \li{__name__} çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ

%ğŸ% Warning: If you import a module that has already been imported,
%ğŸ% Python does nothing.  It does not re-read the file, even if it has
%ğŸ% changed.

è­¦ç¤ºï¼šå¦‚æœä½ å¯¼å…¥ä¸€ä¸ªå·²ç»è¢«å¯¼å…¥äº†çš„æ¨¡å—ï¼ŒPython å°†ä¸ä¼šåšä»»ä½•äº‹æƒ…ã€‚å®ƒå¹¶ä¸ä¼šé‡æ–°è¯»å–æ–‡ä»¶ï¼Œå³ä½¿æ–‡ä»¶çš„å†…å®¹å·²ç»å‘ç”Ÿäº†æ”¹å˜ã€‚
\index{module!reload}  \index{reload function}
\index{function!reload}

%ğŸ% If you want to reload a module, you can use the built-in function
%ğŸ% {\tt reload}, but it can be tricky, so the safest thing to do is
%ğŸ% restart the interpreter and then import the module again.

å¦‚æœä½ è¦é‡è½½ä¸€ä¸ªæ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨å†…å»ºå‡½æ•° \li{reload} ï¼Œä½†å®ƒå¯èƒ½ä¼šå‡ºé”™ã€‚å› æ­¤æœ€å®‰å…¨çš„æ–¹æ³•æ˜¯é‡å¯è§£é‡Šå™¨ï¼Œç„¶åé‡æ–°å¯¼å…¥æ¨¡å—ã€‚

%ğŸ% \section{Debugging  |  è°ƒè¯•}
\section{è°ƒè¯•}
\index{debugging}  \index{whitespace}

%ğŸ% When you are reading and writing files, you might run into problems
%ğŸ% with whitespace.  These errors can be hard to debug because spaces,
%ğŸ% tabs and newlines are normally invisible:

å½“ä½ è¯»å†™æ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ç©ºç™½å¸¦æ¥çš„é—®é¢˜ã€‚è¿™äº›é—®é¢˜ä¼šå¾ˆéš¾è°ƒè¯•ï¼Œå› ä¸ºç©ºæ ¼ã€åˆ¶è¡¨ç¬¦å’Œæ¢è¡Œç¬¦é€šå¸¸æ˜¯çœ‹ä¸è§çš„ï¼š

\begin{lstlisting}
>>> s = '1 2\t 3\n 4'
>>> print(s)
1 2  3
 4
\end{lstlisting}
\index{repr function}  \index{function!repr}
\index{string representation}

%ğŸ% The built-in function {\tt repr} can help.  It takes any object as an
%ğŸ% argument and returns a string representation of the object.  For
%ğŸ% strings, it represents whitespace
%ğŸ% characters with backslash sequences:

å†…å»ºå‡½æ•° \li{repr} å¯ä»¥ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®ƒæ¥å—ä»»æ„ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªè¯¥å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚å¯¹äºç©ºç™½ç¬¦å·ï¼Œå®ƒå°†ç”¨åæ–œæ åºåˆ—è¡¨ç¤ºï¼š

\begin{lstlisting}
>>> print(repr(s))
'1 2\t 3\n 4'
\end{lstlisting}

%ğŸ% This can be helpful for debugging.

è¿™ä¸ªå¯¹äºè°ƒè¯•ä¼šå¾ˆæœ‰ç”¨ã€‚

%ğŸ% One other problem you might run into is that different systems
%ğŸ% use different characters to indicate the end of a line.  Some
%ğŸ% systems use a newline, represented \verb"\n".  Others use
%ğŸ% a return character, represented \verb"\r".  Some use both.
%ğŸ% If you move files between different systems, these inconsistencies
%ğŸ% can cause problems.

å¦ä¸€ä¸ªä½ å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜æ˜¯ï¼Œä¸åŒçš„çš„ç³»ç»Ÿä½¿ç”¨ä¸åŒçš„ç¬¦å·æ¥è¡¨ç¤ºä¸€è¡Œçš„ç»“æŸã€‚
æœ‰äº›ç³»ç»Ÿä½¿ç”¨æ¢è¡Œç¬¦ \li{\n`}ï¼Œæœ‰çš„ä½¿ç”¨è¿”å›ç¬¦å· \li{\r} ï¼Œæœ‰äº›ä¸¤è€…éƒ½ä½¿ç”¨ã€‚
å¦‚æœä½ åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­ç§»åŠ¨æ–‡ä»¶ï¼Œè¿™äº›å·®å¼‚ä¼šå¯¼è‡´é—®é¢˜ã€‚
\index{end of line character}

%ğŸ% For most systems, there are applications to convert from one
%ğŸ% format to another.  You can find them (and read more about this
%ğŸ% issue) at \url{http://en.wikipedia.org/wiki/Newline}.  Or, of course, you
%ğŸ% could write one yourself.

å¯¹å¤§å¤šæ•°çš„ç³»ç»Ÿï¼Œæœ‰ä¸€äº›è½¬æ¢ä¸åŒæ ¼å¼æ–‡ä»¶çš„åº”ç”¨ã€‚
ä½ å¯ä»¥åœ¨ \href{http://en.wikipedia.org/wiki/Newline}{ç»´åŸº} ä¸­æ‰¾åˆ°è¿™äº›åº”ç”¨çš„ä¿¡æ¯(å¹¶é˜…è¯»æ›´å¤šç›¸å…³å†…å®¹)ã€‚ å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™ä¸€ä¸ªè½¬æ¢ç¨‹åºã€‚


\index{ç»´åŸºç™¾ç§‘}


%ğŸ% \section{Glossary  |  æœ¯è¯­è¡¨}
\section{æœ¯è¯­è¡¨}

\begin{description}

%ğŸ% \item[persistent:] Pertaining to a program that runs indefinitely
%ğŸ% and keeps at least some of its data in permanent storage.

\item[æŒä¹…æ€§ (persistent)ï¼š] ç”¨äºæè¿°é•¿æœŸè¿è¡Œå¹¶è‡³å°‘å°†ä¸€éƒ¨åˆ†è‡ªèº«çš„æ•°æ®ä¿å­˜åœ¨æ°¸ä¹…å­˜å‚¨ä¸­çš„ç¨‹åºã€‚
\index{persistence}

%ğŸ% \item[format operator:] An operator, {\tt \%}, that takes a format
%ğŸ% string and a tuple and generates a string that includes
%ğŸ% the elements of the tuple formatted as specified by the format string.

\item[æ ¼å¼åŒ–è¿ç®—ç¬¦ (format operator)ï¼š] è¿ç®—ç¬¦ \li{%}ã€‚
è¯»å–ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²å’Œä¸€ä¸ªå…ƒç»„ï¼Œç”Ÿæˆä¸€ä¸ªåŒ…å«å…ƒç»„ä¸­å…ƒç´ çš„å­—ç¬¦ä¸²ï¼ŒæŒ‰ç…§æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„è¦æ±‚æ ¼å¼åŒ–ã€‚
\index{format operator}  \index{operator!format}

%ğŸ% \item[format string:] A string, used with the format operator, that
%ğŸ% contains format sequences.

\item[æ ¼å¼åŒ–å­—ç¬¦ä¸² (format string)ï¼š] ä¸€ä¸ªåŒ…å«æ ¼å¼åŒ–åºåˆ—çš„å­—ç¬¦ä¸²ï¼Œå’Œæ ¼å¼åŒ–è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚
\index{format string}

%ğŸ% \item[format sequence:] A sequence of characters in a format string,
%ğŸ% like {\tt \%d}, that specifies how a value should be formatted.

\item[æ ¼å¼åŒ–åºåˆ— (format sequence)ï¼š] æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªå­—ç¬¦åºåˆ—ï¼Œä¾‹å¦‚ \li{%d}
ï¼ŒæŒ‡å®šäº†ä¸€ä¸ªå€¼çš„æ ¼å¼ã€‚
\index{format sequence}

%ğŸ% \item[text file:] A sequence of characters stored in permanent
%ğŸ% storage like a hard drive.

\item[æ–‡æœ¬æ–‡ä»¶ (text file)ï¼š]ä¿å­˜åœ¨ç±»ä¼¼ç¡¬ç›˜çš„æ°¸ä¹…å­˜å‚¨è®¾å¤‡ä¸Šçš„å­—ç¬¦åºåˆ—ã€‚
\index{text file}

%ğŸ% \item[directory:] A named collection of files, also called a folder.

\item[ç›®å½• (directory)ï¼š] ä¸€ä¸ªæœ‰å‘½åçš„æ–‡ä»¶é›†åˆï¼Œä¹Ÿå«åšæ–‡ä»¶å¤¹ã€‚
\index{directory}

%ğŸ% \item[path:] A string that identifies a file.

\item[è·¯å¾„ (path)ï¼š] ä¸€ä¸ªæŒ‡å®šä¸€ä¸ªæ–‡ä»¶çš„å­—ç¬¦ä¸²ã€‚
\index{path}

%ğŸ% \item[relative path:] A path that starts from the current directory.

\item[ç›¸å¯¹è·¯å¾„ (relative path)ï¼š] ä»å½“å‰ç›®å½•å¼€å§‹çš„è·¯å¾„ã€‚
\index{relative path}

%ğŸ% \item[absolute path:] A path that starts from the topmost directory
%ğŸ% in the file system.

\item[ç»å¯¹è·¯å¾„ (absolute path)ï¼š] ä»æ–‡ä»¶ç³»ç»Ÿé¡¶éƒ¨å¼€å§‹çš„è·¯å¾„ã€‚
\index{absolute path}

%ğŸ% \item[catch:] To prevent an exception from terminating
%ğŸ% a program using the {\tt try}
%ğŸ% and {\tt except} statements.

\item[æ•è· (catch)ï¼š] ä¸ºäº†é˜²æ­¢ç¨‹åºå› ä¸ºå¼‚å¸¸è€Œç»ˆæ­¢ï¼Œä½¿ç”¨ \li{try} å’Œ \li{except} è¯­å¥æ¥æ•æ‰å¼‚å¸¸ã€‚
\index{catch}

%ğŸ% \item[database:] A file whose contents are organized like a dictionary
%ğŸ% with keys that correspond to values.

\item[æ•°æ®åº“ (database)ï¼š] ä¸€ä¸ªå†…å®¹ç»“æ„ç±»ä¼¼å­—å…¸çš„æ–‡ä»¶ï¼Œå°†é”®æ˜ å°„è‡³å¯¹åº”çš„å€¼ã€‚
\index{database}

%ğŸ% \item[bytes object:] An object similar to a string.

\item[å­—èŠ‚å¯¹è±¡ (bytes object)ï¼š] å’Œå­—ç¬¦ä¸²ç±»çš„å¯¹è±¡ã€‚
\index{bytes object}  \index{object!bytes}

%ğŸ% \item[shell:] A program that allows users to type commands and then
%ğŸ% executes them by starting other programs.

\item[shellï¼š] ä¸€ä¸ªå…è®¸ç”¨æˆ·è¾“å…¥å‘½ä»¤ï¼Œå¹¶é€šè¿‡å¯ç”¨å…¶å®ƒç¨‹åºæ‰§è¡Œå‘½ä»¤çš„ç¨‹åºã€‚
\index{shell}

%ğŸ% \item[pipe object:] An object that represents a running program, allowing
%ğŸ% a Python program to run commands and read the results.

\item[ç®¡é“å¯¹è±¡ (pipe object)ï¼š] ä¸€ä¸ªä»£è¡¨æŸä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„å¯¹è±¡ï¼Œå…è®¸ä¸€ä¸ª Python ç¨‹åºå»è¿è¡Œå‘½ä»¤å¹¶å¾—åˆ°è¿è¡Œç»“æœã€‚

\index{pipe object}  \index{object!pipe}

\end{description}


%ğŸ% \section{Exercises  |  ç»ƒä¹ }
\section{ç»ƒä¹ }

\begin{exercise}

%ğŸ% Write a function called {\tt sed} that takes as arguments a pattern string,
%ğŸ% a replacement string, and two filenames; it should read the first file
%ğŸ% and write the contents into the second file (creating it if
%ğŸ% necessary).  If the pattern string appears anywhere in the file, it
%ğŸ% should be replaced with the replacement string.

ç¼–å†™ä¸€ä¸ªå«åš {\em \li{sed}} çš„å‡½æ•°ï¼Œå®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªæ¨¡å¼å­—ç¬¦ä¸² \footnote{pattern string}ï¼Œä¸€ä¸ªæ›¿æ¢å­—ç¬¦ä¸²å’Œä¸¤ä¸ªæ–‡ä»¶åã€‚
å®ƒåº”è¯¥è¯»å–ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†å†…å®¹å†™å…¥åˆ°ç¬¬äºŒä¸ªæ–‡ä»¶ (éœ€è¦æ—¶åˆ›å»ºå®ƒ)ã€‚
å¦‚æœåœ¨æ–‡ä»¶çš„ä»»ä½•åœ°æ–¹å‡ºç°äº†æ¨¡å¼å­—ç¬¦ä¸²ï¼Œå°±ç”¨æ›¿æ¢å­—ç¬¦ä¸²æ›¿æ¢å®ƒã€‚

%ğŸ% If an error occurs while opening, reading, writing or closing files,
%ğŸ% your program should catch the exception, print an error message, and
%ğŸ% exit.  Solution: \url{http://thinkpython2.com/code/sed.py}.

å¦‚æœåœ¨æ‰“å¼€ã€è¯»å–ã€å†™å…¥æˆ–è€…å…³é—­æ–‡ä»¶æ—¶å‡ºç°äº†é”™è¯¯ï¼Œä½ çš„ç¨‹åºåº”è¯¥æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œæ‰“å°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå¹¶é€€å‡ºã€‚

\href{http://thinkpython2.com/code/sed.py}{å‚è€ƒç­”æ¡ˆ} ã€‚

\end{exercise}

\begin{exercise}
\index{anagram set}
\index{set!anagram}

%ğŸ% If you download my solution to Exercise~\ref{anagrams} from
%ğŸ% \url{http://thinkpython2.com/code/anagram_sets.py}, you'll see that it creates
%ğŸ% a dictionary that maps from a sorted string of letters to the list of
%ğŸ% words that can be spelled with those letters.  For example,
%ğŸ% \verb"'opst'" maps to the list
%ğŸ% \verb"['opts', 'post', 'pots', 'spot', 'stop', 'tops']".

å¦‚æœä½ ä» \href{http://thinkpython2.com/code/anagram_sets.py}{æ­¤å¤„} ä¸‹è½½äº†
ç»ƒä¹ ~{\em \ref{anagrams}} çš„ç­”æ¡ˆï¼Œä½ ä¼šçœ‹åˆ°ç­”æ¡ˆä¸­åˆ›å»ºäº†ä¸€ä¸ªå­—å…¸ï¼Œ
å°†ä»ä¸€ä¸ªç”±æ’åºåçš„å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²æ˜ å°„åˆ°ä¸€ä¸ªå¯ä»¥ç”±è¿™äº›å­—æ¯æ‹¼æˆçš„å•è¯ç»„æˆçš„åˆ—è¡¨ã€‚
ä¾‹å¦‚ï¼Œ {\em \li{'opst'}} æ˜ å°„åˆ°åˆ—è¡¨
{\em \li{['opts', 'post', 'pots', 'spot', 'stop', 'tops']}}ã€‚

%ğŸ% Write a module that imports \verb"anagram_sets" and provides
%ğŸ% two new functions: \verb"store_anagrams" should store the
%ğŸ% anagram dictionary in a ``shelf''; \verb"read_anagrams" should
%ğŸ% look up a word and return a list of its anagrams.
%ğŸ% Solution: \url{http://thinkpython2.com/code/anagram_db.py}.

ç¼–å†™ä¸€ä¸ªæ¨¡å—ï¼Œ å¯¼å…¥ {\em \li{anagram_sets}} å¹¶æä¾›ä¸¤ä¸ªæ–°å‡½æ•°ï¼šå‡½æ•° {\em \li{store_anagrams}} åœ¨å°† {\em \li{anagram}} å­—å…¸ä¿å­˜è‡³ {\em \li{shelf}}ä¸­ï¼› {\em \li{read_anagrams}}
 æŸ¥æ‰¾ä¸€ä¸ªå•è¯ï¼Œ å¹¶è¿”å›å®ƒçš„ {\em \li{anagrams}} åˆ—è¡¨ã€‚

\end{exercise}

\begin{exercise}
\label{checksum}
\index{MP3}

%ğŸ% In a large collection of MP3 files, there may be more than one
%ğŸ% copy of the same song, stored in different directories or with
%ğŸ% different file names.  The goal of this exercise is to search for
%ğŸ% duplicates.

åœ¨ä¸€ä¸ªå¾ˆå¤§çš„MP3æ–‡ä»¶é›†åˆä¸­ï¼Œæˆ–è®¸ä¼šæœ‰åŒä¸€é¦–æ­Œçš„ä¸åŒæ‹·è´ï¼Œ
å®ƒä»¬å­˜æ”¾åœ¨ä¸åŒçš„ç›®å½•ä¸‹æˆ–è€…æœ‰ä¸åŒçš„åå­—ã€‚è¿™ä¸ªç»ƒä¹ çš„ç›®çš„æ˜¯æ£€ç´¢å‡ºè¿™äº›æ‹·è´ã€‚

\begin{enumerate}

%ğŸ% \item Write a program that searches a directory and all of its
%ğŸ% subdirectories, recursively, and returns a list of complete paths
%ğŸ% for all files with a given suffix (like {\tt .mp3}).
%ğŸ% Hint: {\tt os.path} provides several useful functions for
%ğŸ% manipulating file and path names.

\item ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œæœç´¢ä¸€ä¸ªç›®å½•å’Œå®ƒçš„æ‰€æœ‰å­ç›®å½•ï¼Œå¹¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­åŒ…å«æ‰€æœ‰çš„æœ‰ç»™å®šåç¼€(ä¾‹å¦‚{\em .mp3})çš„æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ æç¤ºï¼š {\em \li{os.path}}æä¾›äº†ä¸€äº›å¯ä»¥æ“ä½œæ–‡ä»¶å’Œè·¯å¾„åçš„å‡½æ•°ã€‚

\index{duplicate}  \index{MD5 algorithm}
\index{algorithm!MD5}  \index{checksum}

%ğŸ% \item To recognize duplicates, you can use {\tt md5sum}
%ğŸ% to compute a ``checksum'' for each files.  If two files have
%ğŸ% the same checksum, they probably have the same contents.

\item ä¸ºäº†è¯†åˆ«å‡ºé‡å¤çš„æ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ {\em \li{md5sum}} æ¥è®¡ç®—æ¯ä¸ªæ–‡ä»¶çš„ ``æ ¡éªŒå’Œ''ã€‚ å¦‚æœä¸¤ä¸ªæ–‡ä»¶çš„æ ¡éªŒå’Œç›¸åŒï¼Œå®ƒä»¬å¾ˆå¯èƒ½æœ‰ç›¸åŒçš„å†…å®¹ã€‚

\index{md5sum}

%ğŸ% \item To double-check, you can use the Unix command {\tt diff}.
\index{diff}

\item ä½ å¯ä»¥ä½¿ç”¨ {\em Unix} å‘½ä»¤ {\em \li{diff}} å†ç¡®è®¤ä¸€ä¸‹ã€‚

\end{enumerate}

%ğŸ% Solution: \url{http://thinkpython2.com/code/find_duplicates.py}.

\href{http://thinkpython2.com/code/find_duplicates.py}{å‚è€ƒç­”æ¡ˆ}
\end{exercise}
